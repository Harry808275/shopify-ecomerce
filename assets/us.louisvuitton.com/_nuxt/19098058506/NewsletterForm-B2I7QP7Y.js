(function(){"use strict";(function(t){try{if(t.includes("/static_lvfront/")&&(t=t.replace(/(..\/)+static_lvfront/g,`${window.location.origin}/static_lvfront`)),Array.from(document.head.getElementsByTagName("style")).map(e=>e.innerText).some(e=>e==t))return;if(typeof document<"u"){const e=document.createElement("style");e.appendChild(document.createTextNode(t)),document.head.appendChild(e)}}catch(e){console.error("Css injection error",e)}})(".lv-newsletter-form__form #mobileNo-field{display:none;visibility:hidden}[dir=ltr] .lv-newsletter-form__form #emailConsent-field,[dir=ltr] .lv-newsletter-form__form #isOptinToReceiveMarketingSms-field{margin:0 0 0 1.5rem}[dir=rtl] .lv-newsletter-form__form #emailConsent-field,[dir=rtl] .lv-newsletter-form__form #isOptinToReceiveMarketingSms-field{margin:0 1.5rem 0 0}.lv-newsletter-form__phone-warning{color:#c53929}[dir=ltr] .lv-newsletter-form__additional-info-legal-text{margin:0 0 0 2rem}[dir=rtl] .lv-newsletter-form__additional-info-legal-text{margin:0 2rem 0 0}[dir] .lv-newsletter-form__success-block{background-color:#fff}[dir] .lv-newsletter-form__success-block-text{margin-bottom:2.5rem}.lv-newsletter-form__success-block-text:focus{outline:0}.keyboard-is-used .lv-newsletter-form__success-block-text:focus{outline:2px solid;outline-offset:var(--focus-outline-offset)}.lv-newsletter-form__success-block-buttons{display:flex;flex-wrap:wrap;gap:1rem;justify-content:flex-end}[dir] .lv-newsletter-form__success-block-buttons{padding:2.5rem 0}.lv-newsletter-form__success-block-buttons .lv-button{width:100%}@media screen and (min-width:48rem){.lv-newsletter-form__success-block-buttons .lv-button{width:auto}}[dir] .lv-newsletter-form.-is-mylv .lv-newsletter-form__form .lv-form-container__fields{padding:1.5rem 2rem}[dir] .lv-newsletter-form.-is-mylv .lv-newsletter-form__success-block{padding:3rem}.lv-newsletter-form .lv-form-container__fieldset#phone-field.error .lv-input-phone__number .lv-input-base input:focus,.lv-newsletter-form .lv-form-container__fieldset#phone-field.error .lv-input-phone__prefix .lv-select-dropdown select:focus,.lv-newsletter-form .lv-form-container__fieldset#phone-field.error .lv-input-phone__type .lv-select-dropdown select:focus{outline:none}[dir] .lv-newsletter-form .lv-form-container__fieldset#phone-field.error .lv-input-phone__number .lv-input-base input:focus,[dir] .lv-newsletter-form .lv-form-container__fieldset#phone-field.error .lv-input-phone__prefix .lv-select-dropdown select:focus,[dir] .lv-newsletter-form .lv-form-container__fieldset#phone-field.error .lv-input-phone__type .lv-select-dropdown select:focus{border-color:#c53929;box-shadow:none}")})();
import{_ as v,dB as T,a1 as N,bZ as E,G as l,H as o,L as c,T as k,V as a,X as F,Y as h,J as u,a5 as b,a4 as S,U as f,a0 as m,K as d,Q as M,fr as U,f5 as P,bs as $,dx as O,dY as L,b3 as x,ga as D,bi as B,aM as G,N as R,F as V}from"./layout-DywyNxr9.js";import{e as A,u as H,a as I}from"./repository-BsQT3mIj.js";import{b as W}from"./nuxt-comp-BrT_0Nqp.js";var p=(e=>(e.Subscribe="subscribe",e.Unsubscribe="unsubscribe",e))(p||{});const Q={name:"NewsletterForm",emits:["update:isSubscribeSuccessful","update:isUnsubscribeSuccessful"],components:{FormContainer:E,SmartLink:N,LegalNoticeSection:T},props:{schema:{type:Object,default:()=>({})},type:{type:String,default:"subscribe"},isOpenQubitModal:{type:Boolean,default:!1},isMyLvContext:{type:Boolean,default:!1},isFooterContext:{type:Boolean,default:!1}},setup(){const{isEnabled:e}=W(),{sendTrackingData:s}=V(),{handleSmsConsentPhoneWarning:t,showEmptyPhoneWarning:n}=H(),{trackSmsConsent:i}=I();return{smsConsentEnabled:e("smsConsentEnabled"),sendTrackingData:s,handleSmsConsentPhoneWarning:t,showEmptyPhoneWarning:n,trackSmsConsent:i}},data(){var e,s,t;return{isPending:!1,clientData:[],isSubscribeSuccessful:!1,isUnsubscribeSuccessful:!1,serviceErrors:{},errorMessage:null,registrationUrl:"",informations:{categoryGa:"form_newsletter",actionPosition:"bottom_page"},showMarketingConsent:((t=(s=(e=this.schema)==null?void 0:e.properties)==null?void 0:s.marketingConsent)==null?void 0:t.default)||!1,isSubmitDisabled:!1}},computed:{hasForm(){return!this.isSubscribeSuccessful&&!this.isUnsubscribeSuccessful},homepageUrl(){return this.$localePath(R.Homepage)},isTwist(){return this.$store.getters[G]},isChina(){return this.$store.getters[B]},formattedClientName(){return this.clientData.length>0?`${this.clientData[0].firstName} ${this.clientData[0].lastName}`:""},shouldShowPhoneError(){var n,i;const e=(n=this.$refs.newsletterForm)==null?void 0:n.model;if(!e)return!1;const s=e.isOptinToReceiveMarketingSms,t=(i=e.phone)==null?void 0:i.phoneNumber;return s&&!t}},watch:{showEmptyPhoneWarning(e){if(e){const s={categoryGa:"form_newsletter"};this.trackSmsConsent(s)}}},mounted(){this.$watch(()=>{var e,s;return(s=(e=this.$refs.newsletterForm)==null?void 0:e.model)==null?void 0:s.marketingConsent},this.onMarketingConsentChange,{deep:!0}),this.$watch(()=>{var e,s,t,n;return[(s=(e=this.$refs.newsletterForm)==null?void 0:e.model)==null?void 0:s.emailConsent,(n=(t=this.$refs.newsletterForm)==null?void 0:t.model)==null?void 0:n.isOptinToReceiveMarketingSms]},this.onEmailSmsConsentToggle,{deep:!0}),this.$watch(()=>{var e;return(e=this.$refs.newsletterForm)==null?void 0:e.model},e=>{var s;if(e){this.handleSmsConsentPhoneWarning(e);const t=e.isOptinToReceiveMarketingSms,n=(s=e.phone)==null?void 0:s.phoneNumber;if(this.isSubmitDisabled=t&&!n,t&&!n)this.serviceErrors={...this.serviceErrors,phone:this.$t("mylv_consent_phone_not_filled")};else{const{phone:i,...r}=this.serviceErrors;this.serviceErrors=r}}},{deep:!0}),this.isChina&&(this.registrationUrl=D({locale:this.$store.state.localeContext.locale,legacyUrl:this.$appConfig.legacy_secure_domain_cn}))},methods:{onMarketingConsentChange(e){this.showMarketingConsent=!!e,e&&(this.$refs.newsletterForm.model.emailConsent=!0)},onEmailSmsConsentToggle([e,s]){e===!1&&s===!1&&(this.$refs.newsletterForm.model.marketingConsent=!1)},setPhonePayload(e){const s=e.phone;s&&(e.phoneNumberTelCode=A({countryIsoCode:s.phoneNumberCountry,property:"phone",childProperty:"phoneNumberCountry",schema:this.schema}),e.phoneNumber=s.phoneNumber,delete e.phone)},async handleNewsletterSubmission(){this.resetSubmissionFlags(),this.isPending=!0;const e={...this.$refs.newsletterForm.model};if(this.isChina||this.setEmailTracking(e.email),this.setPhonePayload(e),this.type===p.Subscribe)if(this.isOpenQubitModal?this.sendTrackingOnNewsletterSubmission("qubit_popup_subscribe_intention","qubit_popup_subscribe_intention"):this.sendTrackingOnNewsletterSubmission("subscribe_intention","subscribe_intention",e),e.email===e.emailConfirmation)try{if(Object.assign(e,{status:"active"}),this.isFooterContext&&(e.isFooterContext=!0),await this.$domain.account.guestNewsletterSubscription(e),this.sendTrackingOnNewsletterSubmission("subscription_success","newsletter_subscription_succeeded",e),this.clientData.push(e),this.isPending=!1,this.isSubscribeSuccessful=!0,this.$emit("update:isSubscribeSuccessful",this.isSubscribeSuccessful),this.isTwist&&!this.isFooterContext){const s=`${window.location.origin}${(this._.provides[$]||this.$route).fullPath}`;this.registrationUrl=await O(this,s,L.Registration)}await x(),this.$refs.successText.focus(),this.isFooterContext||window.scrollTo(0,0)}catch(s){this.handleErrors(s),this.sendTrackingOnNewsletterSubmission("subscription_failure","newsletter_subscription_failed",e)}else this.handleErrors({emailConfirmation:this.$t("lib_error_email_confirmation")},!0),this.sendTrackingOnNewsletterSubmission("subscription_failure","newsletter_subscription_failed",e);if(this.type===p.Unsubscribe)try{await this.$domain.account.guestNewsletterUnsubscription(e.emailUnsubscribe),this.sendTrackingOnNewsletterSubmission("unsubscribe","unsubscribe"),this.isPending=!1,this.isUnsubscribeSuccessful=!0,this.$emit("update:isUnsubscribeSuccessful",this.isUnsubscribeSuccessful)}catch(s){this.handleErrors(s),this.sendTrackingOnNewsletterSubmission("unsubscription_failure","newsletter_unsubscription_failed")}},resetSubmissionFlags(){this.isUnsubscribeSuccessful=!1,this.isSubscribeSuccessful=!1},handleErrors(e={},s){this.serviceErrors=s?e:P(e.serviceErrors),this.errorMessage=s?null:this.$t("global_error_message")||e.message,this.isPending=!1},getMarketingChannelValue(e){let s="marketing_email:1";return this.schema&&this.schema.properties.isOptinToReceiveMarketingSms&&(s=`marketing_email:1|marketing_sms:${e.isOptinToReceiveMarketingSms?"1":"0"}`),s},sendTrackingOnNewsletterSubmission(e,s,t){const n={actionGa:e,actionId:s,...this.informations,marketing_channel_type:this.getMarketingChannelValue(t)};this.sendTrackingData(n)},trackingAccountCreation(){return this.sendTrackingData({categoryGa:"form_newsletter",actionGa:"create_my_account"})},trackingBackToHome(){return this.sendTrackingData({categoryGa:"form_newsletter",actionGa:"back_to_home"})},setEmailTracking(e){this.sendTrackingData({mkey:U(e),actionGa:"mkey_submitted",actionId:"mkey_submitted",categoryGa:"mkey_submitted"})}}},X={key:0},j={key:0},q={class:"body-s"},Y={key:0,class:"lv-newsletter-form__additional-info-legal-text body-s -text-is-grey"},z={key:1},J={class:"lv-newsletter-form__success-block"},K={ref:"successText",tabindex:"0",class:"lv-newsletter-form__success-block-text body-l"},Z={key:0,class:"body-s"},ee={key:0,class:"lv-newsletter-form__success-block-buttons"},se={key:2};function te(e,s,t,n,i,r){const C=f("FormContainer"),g=f("SmartLink"),w=f("LegalNoticeSection"),y=S("safe-html"),_=S("tracking");return o(),l("div",{class:M(["lv-newsletter-form",{"-is-mylv":t.isMyLvContext}])},[r.hasForm?(o(),l("section",X,[t.isFooterContext?(o(),l("p",j,a(e.$t("mylv_newsletter_registration_title")),1)):c("",!0),k(C,{id:"newsletter-form",ref:"newsletterForm",class:"lv-newsletter-form__form","form-schema":t.schema,"service-errors":i.serviceErrors,"error-message":i.errorMessage,"is-pending":i.isPending,"is-submit-button-disabled":i.isSubmitDisabled,onSubmit:r.handleNewsletterSubmission},F({"field-content-after-isOptinToReceiveMarketingSms":h(()=>[i.showMarketingConsent?b((o(),l("p",Y,null,512)),[[y,{inline:!0,html:e.$t("preferences_center_channel_marketing_sms_helptext")}]]):c("",!0)]),_:2},[i.showMarketingConsent?{name:"field-content-before-emailConsent",fn:h(()=>[u("p",q,a(e.$t("newsletter_channel_preferences")),1)]),key:"0"}:void 0]),1032,["form-schema","service-errors","error-message","is-pending","is-submit-button-disabled","onSubmit"])])):c("",!0),i.isSubscribeSuccessful?(o(),l("section",z,[u("div",J,[u("p",K,[m(a(r.formattedClientName)+" ",1),s[0]||(s[0]=u("br",null,null,-1)),m(" "+a(e.$t("mylv_newsletter_registration_confirmation")),1),s[1]||(s[1]=u("br",null,null,-1)),s[2]||(s[2]=u("br",null,null,-1)),m(" "+a(e.$t("global_thanksmessage")),1)],512),t.isMyLvContext?(o(),l("span",Z,a(e.$t("mylv_newsletter_subscription_success_message_desc")),1)):c("",!0)]),t.isMyLvContext?(o(),l("div",ee,[b((o(),d(g,{url:r.homepageUrl,class:"lv-newsletter-form__button-back-home lv-button -secondary"},{default:h(()=>[m(a(e.$t("global_go_to_homepage")),1)]),_:1},8,["url"])),[[_,r.trackingBackToHome()]]),b((o(),d(g,{url:i.registrationUrl,class:"lv-newsletter-form__button-registration lv-button -primary"},{default:h(()=>[m(a(e.$t("global_create_mylv_account")),1)]),_:1},8,["url"])),[[_,r.trackingAccountCreation()]])])):c("",!0)])):c("",!0),i.isUnsubscribeSuccessful?(o(),l("section",se,[u("p",null,a(e.$t("mylv_newsletter_unsubscription_confirmation")),1),b((o(),d(g,{url:r.homepageUrl,class:"lv-newsletter-form__button-back-home lv-button -primary"},{default:h(()=>[m(a(e.$t("global_go_to_homepage")),1)]),_:1},8,["url"])),[[_,r.trackingBackToHome()]])])):c("",!0),k(w)],2)}const oe=v(Q,[["render",te]]);export{oe as N};
//# sourceMappingURL=NewsletterForm-B2I7QP7Y.js.map
